language: rust
rust:
- 1.41.1
cache: cargo
os:
- linux
- osx
- windows
before_script:
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then export TARGET=x86_64-apple-darwin  ; fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then export TARGET=x86_64-unknown-linux-gnu  ;
  fi
- if [ "$TRAVIS_OS_NAME" = "windows" ]; then export TARGET=x86_64-pc-windows-msvc  ;
  fi
- rustup component add rustfmt
- rustup update nightly
- rustup target add ${TARGET}
- rustup target add wasm32-unknown-unknown --toolchain nightly
- rustup show
script:
- cargo fmt --all -- --check
- cargo build --release --target=${TARGET}
- mv ./target/${TARGET}/release/joystream-node .
- export FILENAME=`./joystream-node --version | sed -e "s/ /-/g"`
- tar -cf ${FILENAME}.tar ./joystream-node
- gzip ${FILENAME}.tar
deploy:
  provider: releases
  api_key:
    secure: oqlOd1BiScrD/cwUQZpGSPiroDZN6LaHPyunoe5dQNE6cjrt8YCQs5m11G8pbVa7yz3TS2w1eMqO6hyrskL8VF7qxlF44IAGEDQFtd++RX7i0Re1CLcoN29TN3oIpu7IuWaFAJKl3Iu6Dt0CkhgCfvmzJ0gh5EO+49MjhldrQJm0sN+H2PgXudjuObCHayuVz7sO5Tahb1OpNtAlH9F5KQU67aN9ulAM39BXS7dor5lP2EhDq58hiBjPh3AHJroBlxDaGXgRMDGiR5OwDp3eGuqI2xxOkJVEKwyFURAggc74f+VBimRqIHT9NXAyZwC7r0XDxj+7UgHtTwn6uZ022U1tXalI4Txmwf/fdpmuCV/z6a6mXeL3Gk9vs9Y5v8h8XgkuguGLdcwqJxfd8K6mTObzOBonB9I777fuej/LIrOCfoH0DuCPikPBoQb5MMIXEE0364c+a6yrCjlY/2EyG4/XGbM5IP90f+zCk6sGzbpof669rF1DinOac8v6ak+WG0QUVN+AVUS9hQFR3X3Xabeo3f3tzemi4ovc67jTwyagmJuEg0Coc8voLMoma89igYPUZtGlElIFIYvs+AkwnVoQIyPBoosYgM/GfjQXHfgVpTXnuBONNSf2Q/c/gp43dDq0IZxSUgRb4TnPAd64gZPrP01R7yMR3C0U9Z2MJ0o=
  file: "${FILENAME}.tar.gz"
  skip_cleanup: true
  draft: true
  prerelease: true
  overwrite: true
  on:
    repo: mnaamani/substrate-node-joystream
    branch: deploy


